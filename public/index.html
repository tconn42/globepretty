<!DOCTYPE HTML>
<html lang='en-US'>
<head>

  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, user-scalable=0, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <meta charset="utf-8">

  <meta http-equiv="CACHE-CONTROL" CONTENT="NO-CACHE">
  <meta http-equiv="PRAGMA" CONTENT="NO-CACHE">
  <meta name="robots" content="noarchive">
  <meta name="referrer" content="no-referrer">

  <title>Globe Pretty Demo</title>

  <style>
  body
  {
    margin: 0;
    user-select: none;
  }

  #globeViz
  {
    position: absolute;
    left: 0%;
    top: 0%;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    overflow: hidden;
  }
  </style>

  <script type="importmap">
  {
    "imports":
    {
      "three": "https://cdn.jsdelivr.net/npm/three@0.181.2/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.181.2/examples/jsm/"
    }
  }
  </script>

  <script language="javascript" src="dist/dependency/globe.gl.min.js"></script>
  <script type="module" src="dist/globepretty.js"></script>

  <script type="module">

    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

    window.addEventListener('load', () => 
    {
      const container = document.getElementById('globeViz');

      // Gen random data
      let N = 10;
      const rings = [...Array(N).keys()].map(idx => ({
        lat: (idx/N - 0.5) * 180,
        lng: (idx/N - 0.5) * 360,
        maxR: idx/N * 20 + 3,
        propagationSpeed: (idx/N - 0.5) * 20 + 1,
        repeatPeriod: idx/N * 2000 + 200
      }));

      N = 100;
      const points = [...Array(N).keys()].map(idx => ({
        lat: (idx/N - 0.5) * 180,
        lng: (idx/N - 0.5) * 360,
        size: .3, // (100 - idx)/N / 3,
        color: ['red', 'white', 'blue', 'green'][idx%4]
      }));

      const colorInterpolator = t => `rgba(255,100,50,${Math.sqrt(1-t)})`;

      const opts = { receiveShadows: true };

      const globe = new Globe(container, opts)
     //   .ringsData(rings)
        .ringColor(() => colorInterpolator)
        .ringMaxRadius('maxR')
        .ringPropagationSpeed('propagationSpeed')
        .ringRepeatPeriod('repeatPeriod')
     //   .pointsData(points)
        .pointAltitude('size')
        .pointColor('color')
        .pointsMerge(true)
        .particleLat('lat')
        .particleLng('lng')
        .particleAltitude('alt')
        .particlesColor(() => 'palegreen')
        .onGlobeReady(() =>
         {
           setTimeout(() => container.style.visibility = 'visible', 20);

           // Load the glb file
           const loader = new GLTFLoader();

/*
           loader.load('/images/babyyoda.glb', glb =>
           {
             const yoda = glb.scene.children[0];
             yoda.scale.x = yoda.scale.y = yoda.scale.z = 10;
             yoda.position.x = -150;
             yoda.position.y = -250;
             yoda.position.z = 275;
             yoda.rotation.z = Math.PI;
             globe.scene().add(yoda);
           });
*/
           loader.load('/images/trex.glb', glb =>
           {
             const trex = glb.scene;
             trex.scale.x = trex.scale.y = trex.scale.z = 20;
             trex.position.x = -0;
             trex.position.y = 100;
             trex.position.z = 0;
             trex.rotation.y = -Math.PI/2;
             if (opts.receiveShadows)
               globe.castShadows(trex);
             globe.scene().add(trex);

             const mixer = new Globe.THREE.AnimationMixer(glb.scene);
             const attack = mixer.clipAction(glb.animations[0]);
             attack.play();

             const clock = new Globe.THREE.Clock();
             function animate()
             {
               requestAnimationFrame(animate);
               mixer.update(clock.getDelta());
             }
             animate();
           });
         });

    });

  </script>

</head>

<body style='background-color:black;'>
  <div id='globeViz' style='visibility:hidden;'></div>
</body>
</html>